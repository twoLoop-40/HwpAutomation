# OneColOneProblem 구현 분석 및 결과

## 구현 완료 내용

### 1. Idris2 형식 명세
- **파일**: `HwpIdris/OneColOneProblem.idr`
- **상태**: ✅ 컴파일 성공
- **내용**:
  - ParaInfo, ProblemFile, TargetDoc 타입 정의
  - WorkflowStep 상태 열거
  - canTransition 상태 전환 검증
  - WorkflowSpec 인터페이스

### 2. Python 구현
- **파일**: `Tests/E2E/test_one_col_one_problem.py`
- **상태**: ✅ 실행 성공 (기능적으로 동작함)
- **결과**:
  - 2개 문제 파일 처리
  - 출력 파일 크기: 86,528 bytes
  - 최종 페이지: 3 페이지

### 3. 디버깅 도구
- **파일**: `FunctionTest/test_debug_para_scan.py`
- **발견 사항**: 문제 파일당 Para 1개만 존재

---

## 핵심 발견 사항

### 문제 파일 구조 분석

테스트에 사용된 문제 파일들:
```
2023 학교별기출_확통_1학기_중간 29_이화외고_4_3.hwp
2025 커팅 S_공수2_기말_14회차_3_12_6.hwp
```

**구조 특징**:
- Para 개수: **1개** (표/컨트롤 구조 사용)
- 빈 Para: **0개** (제거할 것이 없음)
- 페이지 수: 각 2페이지

### OneColOneProblemLogic.md 가정 vs 실제

| 항목 | OneColOneProblemLogic.md 가정 | 실제 문제 파일 |
|------|------------------------------|---------------|
| Para 개수 | 여러 개 (빈 Para 포함) | 1개 |
| 빈 Para | 존재 (제거 가능) | 없음 |
| 페이지 축소 방법 | 빈 Para 제거 | **불가능** |
| 문서 구조 | 단순 텍스트 기반 | 표/컨트롤 기반 |

---

## 시도한 페이지 축소 방법

### 1. 빈 Para 제거 ❌
- **결과**: 제거할 빈 Para가 없음
- **원인**: 파일이 표/컨트롤 구조로 되어 있어 Para가 1개뿐

### 2. 여백/줄간격/폰트 축소 ❌
- **파일**: `FunctionTest/test_merge_pages_to_one_v2.py`
- **결과**: GetDefault가 0 값 반환, 페이지 변화 없음
- **원인**: 표/컨트롤 기반 문서에서 GetDefault가 제대로 동작하지 않음

---

## 성공한 대안: test_merge_1_problem_per_column.py

### 결과
- **최종 페이지**: 2 페이지 (2개 문제)
- **파일 크기**: 75,776 bytes
- **평균**: 문제당 1페이지

### 차이점
| 항목 | test_one_col_one_problem.py | test_merge_1_problem_per_column.py |
|------|----------------------------|-----------------------------------|
| Para 스캔 | ✅ 구현 | ❌ 없음 |
| 빈 Para 제거 | ✅ 시도 (효과 없음) | ❌ 없음 |
| 페이지 축소 | ✅ 시도 (실패) | ❌ 없음 |
| 결과 페이지 | 3 페이지 | **2 페이지** ✅ |

**결론**: 단순하게 복사/붙여넣기/BreakColumn만 하는 것이 더 나은 결과

---

## 근본 원인 분석

### OneColOneProblemLogic.md의 가정
```
- para 수 확인하기
- para의 시작과 끝을 확인해서 같으면 빈 para임을 확인
- 빈 para제거
- 페이지가 2이상이면 마지막부터 빈파라를 하나씩 제거
```

이 로직은 **단순 텍스트 기반 문서**를 전제로 함.

### 실제 문제 파일
- 표(Table) 또는 컨트롤(Control) 기반 레이아웃
- Para는 1개지만 내부에 복잡한 구조 포함
- 빈 Para가 아닌 **표 내부의 빈 셀** 제거가 필요할 수 있음

---

## 제안 사항

### Option 1: 현재 결과 수용 ✅ 추천
- test_merge_1_problem_per_column.py 방식 사용
- 2개 문제 → 2페이지 (문제당 1페이지 달성)
- 단순하고 안정적

### Option 2: 표 구조 기반 축소 연구
- InitScan/ReleaseScan으로 표 내부 구조 분석
- 표 내부의 빈 셀 또는 빈 행 제거
- **난이도 높음, 시간 소요 큼**

### Option 3: 다른 테스트 파일 사용
- 단순 텍스트 기반 문제 파일 찾기
- OneColOneProblemLogic.md 가정에 맞는 파일 사용
- **현재 파일로는 불가능**

---

## 결론

### 구현 상태
| 항목 | 상태 |
|------|------|
| Idris2 명세 | ✅ 완료 |
| Python 구현 | ✅ 완료 (기능적으로 동작) |
| 테스트 | ✅ 완료 |
| 목표 달성 (1페이지/문제) | ⚠️ 부분적 달성 |

### 기술적 제약
OneColOneProblemLogic.md의 "빈 Para 제거로 페이지 축소" 전략은:
- ✅ 이론적으로 타당함 (단순 텍스트 문서)
- ❌ 현재 테스트 파일에는 적용 불가 (표/컨트롤 구조)

### 권장 사항
**test_merge_1_problem_per_column.py 방식 채택**
- 더 단순하고 안정적
- 실제로 더 좋은 결과 (2페이지 vs 3페이지)
- 불필요한 복잡도 제거
